<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Raquel Pinho" />


<title>RUV_Salmon_DESeq2_EdgeR_with_outliers</title>

<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/navigation-1.1/tabsets.js"></script>
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/navigation-1.1/codefolding.js"></script>
<link href="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/highlightjs-9.12.0/highlight.js"></script>
<link href="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="Goat_milkI_vs_hLZ_milkI_Salmon_R_with_outliers_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">RUV_Salmon_DESeq2_EdgeR_with_outliers</h1>
<h4 class="author">Raquel Pinho</h4>
<h4 class="date">1 de maio de 2019</h4>

</div>


<div id="data" class="section level1">
<h1><span class="header-section-number">1</span> Data</h1>
<p>This code was writen using data from mhlz experiment 2016, where Malnourished and full fed animals were compared after the ingestion of regular milk, lysozyme-rich milk or no milk. The expression along the length of the intestinal tract were assessed by underlying distribution of RNA-seq data. In total we have seven groups and 4 or three animals per group.</p>
<p>I will first set the working directory to where output are going to be saved and choose the groups to be compared if it was not defined on the command line in the server, besides setting up the knitr options:</p>
<pre class="r"><code>#args = commandArgs(trailingOnly=TRUE)
setwd(&quot;C:/Users/rpmello/Desktop/Data Analysis RNASeq/Projeto_Salmon_DESeq_EdgeR&quot;)
#groups &lt;- c(args[1],args[2])
#groups&lt;-c(&quot;FFI&quot;,&quot;No_milkI&quot;)#colocar em ordem alfabÃ©tica e com a inicial da seÃ§Ã£o
dir.create(file.path(&quot;C:/Users/rpmello/Desktop/Data Analysis RNASeq/Projeto_Salmon_DESeq_EdgeR/Output&quot;, sprintf(&quot;%s_vs_%s_Salmon_R_with_outliers&quot;,groups[1], groups[2])), showWarnings = FALSE)
output_dir&lt;-file.path(&quot;C:/Users/rpmello/Desktop/Data Analysis RNASeq/Projeto_Salmon_DESeq_EdgeR/Output&quot;, sprintf(&quot;%s_vs_%s_Salmon_R_with_outliers&quot;,groups[1], groups[2]))
dir.create(file.path(output_dir, &quot;Figures&quot;), showWarnings = FALSE)
sprintf(&quot;Comparison of %s and %s.&quot;, groups[1], groups[2])</code></pre>
<pre><code>## [1] &quot;Comparison of Goat_milkI and hLZ_milkI.&quot;</code></pre>
<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE, results = &quot;asis&quot;, include = TRUE, fig.path = file.path(output_dir,&quot;Figures&quot;), fig.width = 11, fig.height = 8, fig.show = &quot;animated&quot;)</code></pre>
</div>
<div id="deseq2-analysis" class="section level1">
<h1><span class="header-section-number">2</span> DESeq2 analysis</h1>
<p>I will follow the DESeq2 tutorial found <a href="https://github.com/mikelove/asthma">here</a> and <a href="Angus_workshop">here</a></p>
<p>And I will start creating a table of counts with all the samples.But for this I will have to import the counts data and the metadata.</p>
<div id="importing-the-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Importing the data</h2>
<p>The data used was the quant.sf files output from the Salmon software. And I will select the data and the metadata to the groups selected for comparison.</p>
</div>
<div id="importing-and-creating-the-metadata-table" class="section level2">
<h2><span class="header-section-number">2.2</span> Importing and creating the metadata table</h2>
<p>The metadata for the specified comparison was:</p>
<pre class="r"><code>head(selectMetadata)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Pig"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["Description"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["SampleID"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["list_of_files"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["Index"],"name":[5],"type":["int"],"align":["right"]},{"label":["Group"],"name":[6],"type":["fctr"],"align":["left"]},{"label":["Group_sectio"],"name":[7],"type":["fctr"],"align":["left"]},{"label":["Trial"],"name":[8],"type":["fctr"],"align":["left"]},{"label":["Time"],"name":[9],"type":["chr"],"align":["left"]},{"label":["Section"],"name":[10],"type":["fctr"],"align":["left"]},{"label":["Diet"],"name":[11],"type":["fctr"],"align":["left"]},{"label":["Fed"],"name":[12],"type":["fctr"],"align":["left"]},{"label":["Ecoli"],"name":[13],"type":["fctr"],"align":["left"]},{"label":["SectionTimeFed"],"name":[14],"type":["fctr"],"align":["left"]},{"label":["TimeSectionFedChal"],"name":[15],"type":["fctr"],"align":["left"]},{"label":["TRT"],"name":[16],"type":["fctr"],"align":["left"]},{"label":["Collection"],"name":[17],"type":["fctr"],"align":["left"]},{"label":["RNA_ext"],"name":[18],"type":["fctr"],"align":["left"]},{"label":["Lib_const"],"name":[19],"type":["fctr"],"align":["left"]},{"label":["Suceptability"],"name":[20],"type":["fctr"],"align":["left"]},{"label":["Lane"],"name":[21],"type":["fctr"],"align":["left"]},{"label":["Weight_3Week"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["..22"],"name":[23],"type":["lgl"],"align":["right"]},{"label":["RIN"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["Final_Weight"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["MLNT"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["mean_hist_crypt_value"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["mean_hist_height_value"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["mean_hist_LP_value"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["mean_hist_width_value"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["Small_weight"],"name":[31],"type":["int"],"align":["right"]},{"label":["Small_body_ratio"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["Bacteriodetes"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["Firmicutes"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["bac_firm_ratio"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["wt_lt_ratio"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["z_score_animal"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["z_score_group"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["Litter"],"name":[39],"type":["fctr"],"align":["left"]},{"label":["Conductance"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["Paracellular_permeability"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["Transcellular_permeability"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["Labels"],"name":[43],"type":["chr"],"align":["left"]}],"data":[{"1":"29-13","2":"29-13I","3":"index3L8","4":"index3L8_salmon_trim_quant.counts","5":"3","6":"Goat_milk","7":"Goat_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"Goat","13":"No","14":"Ileum_5MalGoat","15":"Wk5_Il_MalGoat","16":"MalGoat","17":"6_17P","18":"13","19":"8_29","20":"NA","21":"8","22":"6.5","23":"NA","24":"9.1","25":"8.3","26":"743.3102","27":"165.3860","28":"206.5360","29":"155.6400","30":"112.4480","31":"454","32":"54.69880","33":"0.010422381","34":"0.9511794","35":"1.0957324","36":"0.1307087","37":"-5.762922","38":"-4.131395","39":"29","40":"18.89","41":"2139.4460","42":"199.80240","43":"Goat_milk1","_rn_":"Goat_milk1"},{"1":"31-13","2":"31-13I","3":"index8L10","4":"index8L10_salmon_trim_quant.counts","5":"8","6":"Goat_milk","7":"Goat_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"Goat","13":"No","14":"Ileum_5MalGoat","15":"Wk5_Il_MalGoat","16":"MalGoat","17":"6_16A","18":"15","19":"8_29","20":"NA","21":"10","22":"9.2","23":"NA","24":"9.0","25":"12.6","26":"5136.9863","27":"138.5030","28":"196.4140","29":"116.9240","30":"110.4580","31":"635","32":"50.39683","33":"0.007131103","34":"0.9775096","35":"0.7295174","36":"0.1836735","37":"-2.813897","38":"-4.131395","39":"31","40":"9.83","41":"950.6824","42":"165.31730","43":"Goat_milk2","_rn_":"Goat_milk2"},{"1":"31-2","2":"31-2I","3":"index4L7","4":"index4L7_salmon_trim_quant.counts","5":"4","6":"Goat_milk","7":"Goat_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"Goat","13":"No","14":"Ileum_5MalGoat","15":"Wk5_Il_MalGoat","16":"MalGoat","17":"6_16P","18":"14","19":"8_29","20":"NA","21":"7","22":"8.1","23":"NA","24":"8.9","25":"11.1","26":"129396.3878","27":"105.0621","28":"277.5232","29":"128.3584","30":"117.9454","31":"635","32":"57.20721","33":"0.006582556","34":"0.4322545","35":"1.5228426","36":"0.1681818","37":"-3.676456","38":"-4.131395","39":"31","40":"13.25","41":"747.3481","42":"40.09299","43":"Goat_milk3","_rn_":"Goat_milk3"},{"1":"31-3","2":"31-3I","3":"index6L9","4":"index6L9_salmon_trim_quant.counts","5":"6","6":"Goat_milk","7":"Goat_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"Goat","13":"No","14":"Ileum_5MalGoat","15":"Wk5_Il_MalGoat","16":"MalGoat","17":"6_16A","18":"14","19":"8_29","20":"NA","21":"9","22":"7.0","23":"NA","24":"9.0","25":"10.0","26":"2664.9746","27":"117.9894","28":"317.9300","29":"147.2134","30":"113.9002","31":"544","32":"54.40000","33":"0.004388371","34":"0.9829951","35":"0.4464286","36":"0.1574803","37":"-4.272304","38":"-4.131395","39":"31","40":"13.17","41":"1421.3730","42":"141.82780","43":"Goat_milk4","_rn_":"Goat_milk4"},{"1":"29-12","2":"29-12I","3":"index2L8","4":"index2L8_salmon_trim_quant.counts","5":"2","6":"hLZ_milk","7":"hLZ_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"hLZ","13":"No","14":"Ileum_5MalhLZ","15":"Wk5_Il_MalhLZ","16":"MalhLZ","17":"6_17P","18":"13","19":"8_29","20":"NA","21":"8","22":"6.5","23":"NA","24":"9.0","25":"8.5","26":"1764.1129","27":"144.1546","28":"273.3916","29":"164.0934","30":"132.3964","31":"544","32":"64.00000","33":"0.004936917","34":"0.9221064","35":"0.5353956","36":"0.1338583","37":"-5.587555","38":"-4.307848","39":"29","40":"8.71","41":"630.6977","42":"37.25648","43":"hLZ_milk1","_rn_":"hLZ_milk1"},{"1":"31-8","2":"31-8I","3":"index3L7","4":"index3L7_salmon_trim_quant.counts","5":"3","6":"hLZ_milk","7":"hLZ_milkI","8":"mhLZ","9":"Wk5","10":"Ileum","11":"Mal","12":"hLZ","13":"No","14":"Ileum_5MalhLZ","15":"Wk5_Il_MalhLZ","16":"MalhLZ","17":"6_16P","18":"15","19":"8_29","20":"NA","21":"7","22":"8.8","23":"NA","24":"8.6","25":"12.6","26":"756.0484","27":"100.5540","28":"225.9400","29":"85.0580","30":"96.0720","31":"635","32":"50.39683","33":"0.016456391","34":"0.7948437","35":"2.0703934","36":"0.1836735","37":"-2.813897","38":"-4.307848","39":"31","40":"14.70","41":"1249.9640","42":"194.59880","43":"hLZ_milk2","_rn_":"hLZ_milk2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="removing-dependent-variables" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Removing dependent variables</h3>
<p>I will remove the metadata that does not present a variation in this comparison or have all unique values in this comparison</p>
<pre class="r"><code>batch_effects&lt;-sapply(1:ncol(selectMetadata), function(i){length(unique(selectMetadata[,i]))!= 1 &amp; length(unique(selectMetadata[,i])) != length(selectMetadata[,i])})
batch_effects&lt;-selectMetadata[,batch_effects]
dependent&lt;-sapply(1:ncol(batch_effects), function(i){length(unique(batch_effects[1:4,i])) == 1 &amp; length(unique(batch_effects[5:8,i])) == 1})
independent&lt;-which(!dependent)
batch_effects&lt;-batch_effects[,independent]
batch_effects$Group&lt;-group
batch_effects</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Index"],"name":[1],"type":["int"],"align":["right"]},{"label":["Collection"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["RNA_ext"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["Lane"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["Weight_3Week"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["RIN"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Final_Weight"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Small_weight"],"name":[8],"type":["int"],"align":["right"]},{"label":["Small_body_ratio"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Bacteriodetes"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["wt_lt_ratio"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["z_score_animal"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Litter"],"name":[13],"type":["fctr"],"align":["left"]},{"label":["Group"],"name":[14],"type":["fctr"],"align":["left"]}],"data":[{"1":"3","2":"6_17P","3":"13","4":"8","5":"6.5","6":"9.1","7":"8.3","8":"454","9":"54.69880","10":"0.010422381","11":"0.1307087","12":"-5.762922","13":"29","14":"Goat_milk","_rn_":"Goat_milk1"},{"1":"8","2":"6_16A","3":"15","4":"10","5":"9.2","6":"9.0","7":"12.6","8":"635","9":"50.39683","10":"0.007131103","11":"0.1836735","12":"-2.813897","13":"31","14":"Goat_milk","_rn_":"Goat_milk2"},{"1":"4","2":"6_16P","3":"14","4":"7","5":"8.1","6":"8.9","7":"11.1","8":"635","9":"57.20721","10":"0.006582556","11":"0.1681818","12":"-3.676456","13":"31","14":"Goat_milk","_rn_":"Goat_milk3"},{"1":"6","2":"6_16A","3":"14","4":"9","5":"7.0","6":"9.0","7":"10.0","8":"544","9":"54.40000","10":"0.004388371","11":"0.1574803","12":"-4.272304","13":"31","14":"Goat_milk","_rn_":"Goat_milk4"},{"1":"2","2":"6_17P","3":"13","4":"8","5":"6.5","6":"9.0","7":"8.5","8":"544","9":"64.00000","10":"0.004936917","11":"0.1338583","12":"-5.587555","13":"29","14":"hLZ_milk","_rn_":"hLZ_milk1"},{"1":"3","2":"6_16P","3":"15","4":"7","5":"8.8","6":"8.6","7":"12.6","8":"635","9":"50.39683","10":"0.016456391","11":"0.1836735","12":"-2.813897","13":"31","14":"hLZ_milk","_rn_":"hLZ_milk2"},{"1":"5","2":"6_17P","3":"16","4":"9","5":"6.1","6":"8.8","7":"8.8","8":"544","9":"61.81818","10":"0.004936917","11":"0.1442623","12":"-5.008270","13":"33","14":"hLZ_milk","_rn_":"hLZ_milk3"},{"1":"6","2":"6_16P","3":"16","4":"8","5":"6.9","6":"9.3","7":"10.1","8":"544","9":"53.86139","10":"0.008776742","11":"0.1655738","12":"-3.821669","13":"33","14":"hLZ_milk","_rn_":"hLZ_milk4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>From now on I will use the manual from <a href="https://bioconductor.org/packages/release/bioc/vignettes/RUVSeq/inst/doc/RUVSeq.pdf">RUVSeq</a> and the manual from <a href="https://www.bioconductor.org/packages/devel/workflows/vignettes/rnaseqGene/inst/doc/rnaseqGene.html#using-ruv-with-deseq2">DESeq2</a></p>
</div>
</div>
<div id="deseq-object" class="section level2">
<h2><span class="header-section-number">2.3</span> DESeq object</h2>
<p>Creating a DESeqDataSet for the in this case we will use the design ~Group, because, for know we are only interested in the normalized counts to filter low counts and calculate the variation varible with RUV.</p>
<pre class="r"><code>library(DESeq2)
dds &lt;-DESeqDataSetFromTximport(txidata, batch_effects, as.formula(&quot;~Group&quot;))</code></pre>
<pre><code>## factor levels were dropped which had no samples</code></pre>
<pre><code>## using counts and average transcript lengths from tximport</code></pre>
<pre class="r"><code>#It doesn&#39;t matter the formula now, because I am just interested in the counts, but I 
dds&lt;-estimateSizeFactors(dds)</code></pre>
<pre><code>## using &#39;avgTxLength&#39; from assays(dds), correcting for library size</code></pre>
<pre class="r"><code>dds&lt;-DESeq(dds)</code></pre>
<pre><code>## using pre-existing normalization factors</code></pre>
<pre><code>## estimating dispersions</code></pre>
<pre><code>## gene-wise dispersion estimates</code></pre>
<pre><code>## mean-dispersion relationship</code></pre>
<pre><code>## final dispersion estimates</code></pre>
<pre><code>## fitting model and testing</code></pre>
<div id="filtering-low-expressed-genes" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Filtering low expressed genes</h3>
<p>I wil remove the genes if low counts, and I am being very stringent here, removing the ones tha have lower than 20 counts in all the samples and the ones that have less then 5 counts in at least two samples.</p>
<p>I will use the <a href="http://bioconductor.org/packages/release/bioc/manuals/EDASeq/man/EDASeq.pdf">EDASeq</a> package just to create an object were I can store the data and the metadata for multiple analysis.</p>
<pre class="r"><code>library(EDASeq)
library(RColorBrewer)
#creating a set with the expression dat
set&lt;-newSeqExpressionSet(DESeq2::counts(dds), phenoData= batch_effects)
set</code></pre>
<p>SeqExpressionSet (storageMode: lockedEnvironment) assayData: 22630 features, 8 samples element names: counts, normalizedCounts, offset protocolData: none phenoData sampleNames: Goat_milk1 Goat_milk2 … hLZ_milk4 (8 total) varLabels: Index Collection … Group (14 total) varMetadata: labelDescription featureData: none experimentData: use ‘experimentData(object)’ Annotation:</p>
<pre class="r"><code>colors&lt;-brewer.pal(4,&quot;Set2&quot;)
idx  &lt;- rowSums(EDASeq::counts(set) &gt; 5) &gt;= 2
set  &lt;- set[idx, ]
filter&lt;-apply(EDASeq::counts(set),1,function(x){length(x[x&gt;5])&gt;2})
set &lt;-set[filter,]
sprintf(&quot;Removed %s genes with low counts from %s total genes&quot;, nrow(EDASeq::counts(dds))-nrow(EDASeq::counts(set)),nrow(DESeq2::counts(dds)))</code></pre>
<p>[1] “Removed 5840 genes with low counts from 22630 total genes”</p>
</div>
</div>
<div id="ruvseq" class="section level2">
<h2><span class="header-section-number">2.4</span> RUVSeq</h2>
<p>The number of sig DE genes with mod1 (~Group) was:</p>
<pre class="r"><code>res&lt;-results(dds)
sigres&lt;-res[!is.na(res$padj),]
sigres&lt;-sigres[sigres$padj&lt;0.1 &amp; sigres$log2FoldChange&gt;1| sigres$log2FoldChange&lt; -1,]
dim(sigres)</code></pre>
<p>[1] 589 6</p>
<div id="box-plot-of-the-counts-per-sample" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Box plot of the counts per sample</h3>
<p>We can analyze the variation of the counts before normalization and reduced variation.</p>
<pre class="r"><code>plotRLE(set, outline =F, ylim=c(-2,2), col=colors[set$Group])</code></pre>
<div class="figure">
<img src="Figuresbox_plot_counts-1.png" />

</div>
<pre class="r"><code>plotPCA(set, col=colors[set$Group])</code></pre>
<div class="figure">
<img src="Figuresbox_plot_counts-2.png" />

</div>
</div>
<div id="upper-quartile-normalization" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Upper quartile normalization</h3>
<p>The upper quartile normalization <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-11-94">(UQ)</a> normalizes the data accounting for the most highly expressed transcripts, since there is a bias on the number of reads associated to them, i.e, more expresssed trancripts generate more reads and futhermore the number of reads on these highly expressed genes is proportional to the total number of reads in the sample (if samples are in individual lanes or in the same lane), which is not the case for me. <a href="http://vinaykmittal.blogspot.com/2013/10/fpkmrpkm-normalization-caveat-and-upper.html">Here</a>a more human explanation. And <a href="https://academic.oup.com/bib/article/14/6/671/189645">here</a> a more recent paper on RNA data normalization.</p>
<pre class="r"><code>set_n&lt;-betweenLaneNormalization(set,which = &quot;upper&quot;)
set_n$Group&lt;-factor(set_n$Group)
plotRLE(set_n, outline=F, col=colors[set_n$Group])</code></pre>
<div class="figure">
<img src="Figuresupper-1.png" />

</div>
<pre class="r"><code>plotPCA(set_n,col=colors[set_n$Group])</code></pre>
<div class="figure">
<img src="Figuresupper-2.png" />

</div>
</div>
<div id="using-empirical-control-genes" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Using empirical control genes</h3>
<p>Since no spike in were used we will use the genes that have least changed between samples ( least significantly DE genes ) and use them as controls for the unwanted factors. So first we do a DE analysis and find the genes and then we do the normalization.</p>
</div>
<div id="empirical-controls-using-the-prior-de-analisis-using-deseq2" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Empirical controls using the prior DE analisis using DESeq2</h3>
<p>Now we are going to use the DESeq2 to do DE analysis so we can pick the least DE genes as controls.In this case I will estimate only one unwanted variacen variable.</p>
<pre class="r"><code>#Using RUVSeq
library(RUVSeq)
not.sig &lt;- rownames(res)[which(res$pvalue &gt; .2)]
empirical &lt;- rownames(set_n)[ rownames(set_n) %in% not.sig ]
if(&quot;RDAVIDWebService&quot; %in% (.packages())){
  detach(&quot;package:RDAVIDWebService&quot;, unload=TRUE) 
}
set_n &lt;- RUVg(set_n, empirical, k=1)
pData(set_n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Index"],"name":[1],"type":["int"],"align":["right"]},{"label":["Collection"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["RNA_ext"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["Lane"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["Weight_3Week"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["RIN"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Final_Weight"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Small_weight"],"name":[8],"type":["int"],"align":["right"]},{"label":["Small_body_ratio"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Bacteriodetes"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["wt_lt_ratio"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["z_score_animal"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Litter"],"name":[13],"type":["fctr"],"align":["left"]},{"label":["Group"],"name":[14],"type":["fctr"],"align":["left"]},{"label":["W_1"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"6_17P","3":"13","4":"8","5":"6.5","6":"9.1","7":"8.3","8":"454","9":"54.69880","10":"0.010422381","11":"0.1307087","12":"-5.762922","13":"29","14":"Goat_milk","15":"-0.113040041","_rn_":"Goat_milk1"},{"1":"8","2":"6_16A","3":"15","4":"10","5":"9.2","6":"9.0","7":"12.6","8":"635","9":"50.39683","10":"0.007131103","11":"0.1836735","12":"-2.813897","13":"31","14":"Goat_milk","15":"0.103840897","_rn_":"Goat_milk2"},{"1":"4","2":"6_16P","3":"14","4":"7","5":"8.1","6":"8.9","7":"11.1","8":"635","9":"57.20721","10":"0.006582556","11":"0.1681818","12":"-3.676456","13":"31","14":"Goat_milk","15":"-0.451662407","_rn_":"Goat_milk3"},{"1":"6","2":"6_16A","3":"14","4":"9","5":"7.0","6":"9.0","7":"10.0","8":"544","9":"54.40000","10":"0.004388371","11":"0.1574803","12":"-4.272304","13":"31","14":"Goat_milk","15":"0.678575458","_rn_":"Goat_milk4"},{"1":"2","2":"6_17P","3":"13","4":"8","5":"6.5","6":"9.0","7":"8.5","8":"544","9":"64.00000","10":"0.004936917","11":"0.1338583","12":"-5.587555","13":"29","14":"hLZ_milk","15":"0.332333160","_rn_":"hLZ_milk1"},{"1":"3","2":"6_16P","3":"15","4":"7","5":"8.8","6":"8.6","7":"12.6","8":"635","9":"50.39683","10":"0.016456391","11":"0.1836735","12":"-2.813897","13":"31","14":"hLZ_milk","15":"-0.124186093","_rn_":"hLZ_milk2"},{"1":"5","2":"6_17P","3":"16","4":"9","5":"6.1","6":"8.8","7":"8.8","8":"544","9":"61.81818","10":"0.004936917","11":"0.1442623","12":"-5.008270","13":"33","14":"hLZ_milk","15":"0.005506158","_rn_":"hLZ_milk3"},{"1":"6","2":"6_16P","3":"16","4":"8","5":"6.9","6":"9.3","7":"10.1","8":"544","9":"53.86139","10":"0.008776742","11":"0.1655738","12":"-3.821669","13":"33","14":"hLZ_milk","15":"-0.431367131","_rn_":"hLZ_milk4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Using the unwanted variance variable in DESeq ( ~ W1 + Group).</p>
<pre class="r"><code>ddsruv &lt;- dds
ddsruv$W1 &lt;- set_n$W_1
design(ddsruv) &lt;- ~ W1 + Group
dds&lt;-ddsruv</code></pre>
</div>
</div>
<div id="check-sample-distances" class="section level2">
<h2><span class="header-section-number">2.5</span> Check sample distances</h2>
<p>We will use the <code>dist</code> function to calculate Euclidean distances bewteen samples and see with the sample within groups are similar. And in this case we will use the rlog transformed data so the high variance if the low expressed genes do not influence the calculations.</p>
<p>Poisson distance of the smples and euclidean of rlog transformed data.</p>
<p>The heatmap of the rlog transformed counts using poisson distance.</p>
<pre class="r"><code>colors&lt;- colorRampPalette(rev(brewer.pal(9,&quot;Blues&quot;)))(255)
hc&lt;- hclust(poisd$dd)
heatmap.2(samplePoisDistMatrix, Rowv=as.dendrogram(hc), symm=T, trace=&quot;none&quot;, col= colors, margins=c(2,10), labCol=F)</code></pre>
<p><img src="Figuresheatmap_rlog_poisson-1.png" /><!-- --></p>
<p>We can also see the PCA plot:</p>
<pre class="r"><code>library(ggplot2)
z &lt;-plotPCA(rlogdds, intgroup = c( &quot;Group&quot;))
z+ geom_text(aes(label = selectMetadata$Pig))</code></pre>
<div class="figure">
<img src="FiguresPCA_plot-1.png" />

</div>
<pre class="r"><code># Using the both
percentVar &lt;- round(100 * attr(z, &quot;percentVar&quot;))
ggplot(as.data.frame(z$data), aes(PC1, PC2, shape=Group, color=rlogdds$Collection)) +  geom_point(size=3) +
  xlab(paste0(&quot;PC1: &quot;,percentVar[1],&quot;% variance&quot;)) +
  ylab(paste0(&quot;PC2: &quot;,percentVar[2],&quot;% variance&quot;)) + 
  coord_fixed()+ geom_text(aes(label = selectMetadata$Pig))</code></pre>
<div class="figure">
<img src="FiguresPCA_plot-2.png" />

</div>
</div>
<div id="differrential-expression-analaysis" class="section level2">
<h2><span class="header-section-number">2.6</span> Differrential expression analaysis</h2>
<p>It is convenient to make sure that FF is the first level in the Diet factor so the default log2 fold change can be calculatedmalnourished over full fed.</p>
<p>Now, we can run the DESeq function that will estimate the size factors (estimate for differences due to library size), estimate dispersion for each gene, and fit in a generalized linear model.</p>
<p>we have this number of genes with padj &lt; 0.1 L2FC 1. the L2FC estimation is based on MLE (betaprior is False) and the last variable is the contrast that is used.</p>
<p>The summary of the results from the DE analysis using DESeq2, where the low counts were excluded from testing due to being lower than the mean count.</p>
<pre class="r"><code>summary(res)</code></pre>
<p>out of 16241 with nonzero total read count adjusted p-value &lt; 0.1 LFC &gt; 0 (up) : 80, 0.49% LFC &lt; 0 (down) : 112, 0.69% outliers [1] : 0, 0% low counts [2] : 1260, 7.8% (mean count &lt; 23) [1] see ‘cooksCutoff’ argument of ?results [2] see ‘independentFiltering’ argument of ?results</p>
<pre class="r"><code>#the low counts in the summary is the number of genes that were excluded from testing because the countes were lower than the mean count calculated by DESeq.
# it will test the last variable from the design , 
# This will give me the genes that are significantly different with a adj. pvalue &lt; 0.1.
# To make it more stringent we can use adj.pvalue &lt; 0.05, and L2fc &gt; 2, or &lt; -2.</code></pre>
<p>Now we can filter the results by p. adjusted and log2foldChange values.Here we used padj&lt; 0.1, log2FoldChange &lt; -1 or log2FoldChange &gt; 1. The table and the dimentions of the table of DE genes were:</p>
<pre class="r"><code>res.sort&lt;- res[order(res$pvalue), ]
#head(res)
#Considering a padj &lt; 0.1 being significant  we can subset the significant differentiated genes
#resSig_Salmon &lt;- subset(res, padj&lt; 0.1)
res&lt;-as.data.frame(res)
resSig_Salmon &lt;- res[res$padj&lt; 0.1,]
resSig_Salmon &lt;- subset(resSig_Salmon, log2FoldChange &lt; -1 | log2FoldChange &gt; 1)
saveRDS(resSig_Salmon, file = file.path(output_dir,sprintf(&quot;%s_vs_%s_Salmon_resSig_w_outlier.RDS&quot;,groups[1], groups[2])))
head(as.data.frame(resSig_Salmon))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"861.86769","2":"-1.005260","3":"0.2601169","4":"-3.864647","5":"1.112498e-04","6":"0.02487512","_rn_":"ENSSSCG00000000687"},{"1":"269.96680","2":"1.005522","3":"0.2452935","4":"4.099262","5":"4.144701e-05","6":"0.01298702","_rn_":"ENSSSCG00000000789"},{"1":"35.92068","2":"-1.144182","3":"0.3551764","4":"-3.221446","5":"1.275456e-03","6":"0.09951881","_rn_":"ENSSSCG00000002658"},{"1":"141.31976","2":"-1.027279","3":"0.2802161","4":"-3.666023","5":"2.463513e-04","6":"0.03884831","_rn_":"ENSSSCG00000002821"},{"1":"68.09568","2":"-1.097899","3":"0.2853458","4":"-3.847608","5":"1.192767e-04","6":"0.02589686","_rn_":"ENSSSCG00000003437"},{"1":"97.06451","2":"1.110386","3":"0.3212803","4":"3.456128","5":"5.479958e-04","6":"0.06529223","_rn_":"ENSSSCG00000003758"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>dim(resSig_Salmon)</code></pre>
<p>[1] 37 6</p>
<div id="increased-strigency" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Increased strigency</h3>
<p>Being more stringent we can see the number of genes with padj&lt; 0.1 and L2FC &lt; -1.5 or &gt; 1.5</p>
<pre class="r"><code>resSig_Salmon&lt;-resSig_Salmon[order(resSig_Salmon$padj), ]
resSig_Salmon1.5 &lt;- subset(resSig_Salmon, log2FoldChange &lt; -1.5 | log2FoldChange &gt; 1.5)
dim(resSig_Salmon1.5)</code></pre>
<p>[1] 12 6</p>
</div>
<div id="sorting-by-up-regulated-or-down-regulated-genes" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Sorting by up regulated or down regulated genes</h3>
<p>First a look at the top downregulated genes (based on log2foldchange):</p>
<pre class="r"><code># sorting by the Log2FoldChange
head(as.data.frame(resSig_Salmon[order(resSig_Salmon$log2FoldChange), ])) # stronger downregulation</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"70.54569","2":"-3.327207","3":"0.9430750","4":"-3.528041","5":"4.186477e-04","6":"0.053604802","_rn_":"ENSSSCG00000037054"},{"1":"1344.22176","2":"-2.162978","3":"0.4414607","4":"-4.899593","5":"9.603516e-07","6":"0.001198919","_rn_":"ENSSSCG00000036127"},{"1":"77.70074","2":"-1.988181","3":"0.4326390","4":"-4.595474","5":"4.317676e-06","6":"0.002812309","_rn_":"ENSSSCG00000006450"},{"1":"159.06976","2":"-1.818305","3":"0.4633411","4":"-3.924334","5":"8.696995e-05","6":"0.021358964","_rn_":"ENSSSCG00000036628"},{"1":"98.56452","2":"-1.813641","3":"0.3880024","4":"-4.674305","5":"2.949504e-06","6":"0.002454807","_rn_":"ENSSSCG00000031595"},{"1":"79.12986","2":"-1.749305","3":"0.4278194","4":"-4.088886","5":"4.334495e-05","6":"0.012987015","_rn_":"ENSSSCG00000030371"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>topdown_salmon&lt;-rownames(head(resSig_Salmon[order(resSig_Salmon$log2FoldChange), ],10)) # stronger downregulation

#Getting the down regulated genes 
downresSig_Salmon&lt;-resSig_Salmon[resSig_Salmon$log2FoldChange &lt; -1,]
downresSig_Salmon&lt;-downresSig_Salmon[order(downresSig_Salmon$log2FoldChange),]
dim(downresSig_Salmon)</code></pre>
<p>[1] 24 6</p>
<p>And now at the upregulated genes:</p>
<pre class="r"><code>head(as.data.frame(resSig_Salmon[order(-resSig_Salmon$log2FoldChange), ])) #stronger upregulation</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"39.28067","2":"1.953554","3":"0.4925752","4":"3.966002","5":"7.308823e-05","6":"0.018878187","_rn_":"ENSSSCG00000035712"},{"1":"77.11636","2":"1.611269","3":"0.4285023","4":"3.760235","5":"1.697537e-04","6":"0.031396043","_rn_":"ENSSSCG00000021647"},{"1":"52.92358","2":"1.545866","3":"0.3640045","4":"4.246831","5":"2.168153e-05","6":"0.009280314","_rn_":"ENSSSCG00000015068"},{"1":"33.30967","2":"1.498743","3":"0.3838922","4":"3.904074","5":"9.458674e-05","6":"0.022603508","_rn_":"ENSSSCG00000038602"},{"1":"112.86255","2":"1.399114","3":"0.4237886","4":"3.301443","5":"9.618872e-04","6":"0.088405103","_rn_":"ENSSSCG00000040681"},{"1":"100.11980","2":"1.236174","3":"0.3648922","4":"3.387777","5":"7.046149e-04","6":"0.072597336","_rn_":"ENSSSCG00000020859"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>topup_salmon&lt;-rownames(head(resSig_Salmon[order(-resSig_Salmon$log2FoldChange), ],10)) #stronger upregulation

#Getting the up regulated genes
upresSig_Salmon&lt;-resSig_Salmon[resSig_Salmon$log2FoldChange &gt; 1,]
upresSig_Salmon&lt;-upresSig_Salmon[order(-upresSig_Salmon$log2FoldChange),]
dim(upresSig_Salmon)</code></pre>
<p>[1] 13 6</p>
<div id="list-of-genes-with-padj-0.1-l2fc--1-or-1." class="section level4">
<h4><span class="header-section-number">2.6.2.1</span> List of genes with padj &lt; 0.1, L2FC &lt; -1 or &gt; 1.</h4>
<p>Now we can have the list of the genes that are DE expressed and down or up regulated and then convert the ensembl ids into gene names using BiomaRt.</p>
<p>The number of downregulated genes with successful convertion and the top 30 downregulated (based on log2folfchange) genes were:</p>
<pre class="r"><code>library(biomaRt)
mart&lt;- useMart(&quot;ensembl&quot;)
Pig_ensembl&lt;- useDataset(&quot;sscrofa_gene_ensembl&quot;, mart=mart)
Human&lt;-useDataset(&quot;hsapiens_gene_ensembl&quot;, mart=mart)
down_genes_names&lt;- getBM(attributes = c(&quot;ensembl_gene_id&quot;,&quot;external_gene_name&quot;), filters= &quot;ensembl_gene_id&quot;, values = rownames(downresSig_Salmon), mart = Pig_ensembl)
down_genes_names&lt;-transform(merge(as.data.frame(downresSig_Salmon),down_genes_names,by.x=0, by.y =&quot;ensembl_gene_id&quot;,all=TRUE), row.names=Row.names, Row.names=NULL)
down_genes_names_Salmon&lt;- down_genes_names[order(down_genes_names$log2FoldChange),]
#The number of genes  we were able to find the gene name on BiomaRt
sum(down_genes_names_Salmon$external_gene_name != &quot;&quot;)</code></pre>
<p>[1] 14</p>
<pre class="r"><code>head(down_genes_names_Salmon[order(down_genes_names_Salmon$padj),], 30)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["external_gene_name"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"1344.22176","2":"-2.162978","3":"0.4414607","4":"-4.899593","5":"9.603516e-07","6":"0.001198919","7":"","_rn_":"ENSSSCG00000036127"},{"1":"98.56452","2":"-1.813641","3":"0.3880024","4":"-4.674305","5":"2.949504e-06","6":"0.002454807","7":"","_rn_":"ENSSSCG00000031595"},{"1":"77.70074","2":"-1.988181","3":"0.4326390","4":"-4.595474","5":"4.317676e-06","6":"0.002812309","7":"CD1E","_rn_":"ENSSSCG00000006450"},{"1":"2891.41558","2":"-1.018606","3":"0.2197978","4":"-4.634286","5":"3.581708e-06","6":"0.002812309","7":"C1QB","_rn_":"ENSSSCG00000033512"},{"1":"358.43774","2":"-1.198165","3":"0.2671340","4":"-4.485259","5":"7.282538e-06","6":"0.004545821","7":"","_rn_":"ENSSSCG00000033114"},{"1":"71.28128","2":"-1.435378","3":"0.3255227","4":"-4.409456","5":"1.036308e-05","6":"0.005544619","7":"CSF3R","_rn_":"ENSSSCG00000025795"},{"1":"4767.72271","2":"-1.010931","3":"0.2318677","4":"-4.359945","5":"1.300951e-05","6":"0.006496517","7":"C1QC","_rn_":"ENSSSCG00000038706"},{"1":"79.12986","2":"-1.749305","3":"0.4278194","4":"-4.088886","5":"4.334495e-05","6":"0.012987015","7":"","_rn_":"ENSSSCG00000030371"},{"1":"459.84911","2":"-1.070319","3":"0.2635409","4":"-4.061302","5":"4.879972e-05","6":"0.013793748","7":"","_rn_":"ENSSSCG00000038215"},{"1":"102.82958","2":"-1.560226","3":"0.3856544","4":"-4.045658","5":"5.217633e-05","6":"0.014475067","7":"PLA2R1","_rn_":"ENSSSCG00000015885"},{"1":"99.33067","2":"-1.438750","3":"0.3604103","4":"-3.991978","5":"6.552443e-05","6":"0.017221429","7":"TIFAB","_rn_":"ENSSSCG00000038110"},{"1":"159.06976","2":"-1.818305","3":"0.4633411","4":"-3.924334","5":"8.696995e-05","6":"0.021358964","7":"","_rn_":"ENSSSCG00000036628"},{"1":"861.86769","2":"-1.005260","3":"0.2601169","4":"-3.864647","5":"1.112498e-04","6":"0.024875117","7":"CD4","_rn_":"ENSSSCG00000000687"},{"1":"68.09568","2":"-1.097899","3":"0.2853458","4":"-3.847608","5":"1.192767e-04","6":"0.025896863","7":"TNFRSF8","_rn_":"ENSSSCG00000003437"},{"1":"321.72586","2":"-1.354174","3":"0.3525863","4":"-3.840687","5":"1.226903e-04","6":"0.026257485","7":"","_rn_":"ENSSSCG00000032499"},{"1":"332.40499","2":"-1.217092","3":"0.3303830","4":"-3.683884","5":"2.297072e-04","6":"0.037815863","7":"CCL11","_rn_":"ENSSSCG00000040648"},{"1":"141.31976","2":"-1.027279","3":"0.2802161","4":"-3.666023","5":"2.463513e-04","6":"0.038848309","7":"CCL22","_rn_":"ENSSSCG00000002821"},{"1":"135.33002","2":"-1.563911","3":"0.4295071","4":"-3.641176","5":"2.713957e-04","6":"0.041915250","7":"","_rn_":"ENSSSCG00000040548"},{"1":"1081.85403","2":"-1.745359","3":"0.4937336","4":"-3.535021","5":"4.077429e-04","6":"0.053116494","7":"ITLN2","_rn_":"ENSSSCG00000025885"},{"1":"70.54569","2":"-3.327207","3":"0.9430750","4":"-3.528041","5":"4.186477e-04","6":"0.053604802","7":"","_rn_":"ENSSSCG00000037054"},{"1":"491.51671","2":"-1.016355","3":"0.2944608","4":"-3.451581","5":"5.573115e-04","6":"0.065292227","7":"CCR7","_rn_":"ENSSSCG00000017466"},{"1":"364.76390","2":"-1.188105","3":"0.3579052","4":"-3.319607","5":"9.014412e-04","6":"0.084933899","7":"TRH","_rn_":"ENSSSCG00000011596"},{"1":"31.60752","2":"-1.393200","3":"0.4245238","4":"-3.281795","5":"1.031487e-03","6":"0.091481245","7":"","_rn_":"ENSSSCG00000036301"},{"1":"35.92068","2":"-1.144182","3":"0.3551764","4":"-3.221446","5":"1.275456e-03","6":"0.099518812","7":"FOXL1","_rn_":"ENSSSCG00000002658"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>For the upregulated:</p>
<pre class="r"><code>up_genes_names&lt;- getBM(attributes = c(&quot;ensembl_gene_id&quot;,&quot;external_gene_name&quot;), filters= &quot;ensembl_gene_id&quot;, values = rownames(upresSig_Salmon), mart = Pig_ensembl)
up_genes_names&lt;-transform(merge(as.data.frame(upresSig_Salmon),up_genes_names,by.x=0, by.y =&quot;ensembl_gene_id&quot;,all=TRUE), row.names=Row.names, Row.names=NULL)
up_genes_names_Salmon&lt;- up_genes_names[order(up_genes_names$log2FoldChange),]
sum(up_genes_names_Salmon$external_gene_name != &quot;&quot;)</code></pre>
<p>[1] 10</p>
<pre class="r"><code>#The number of genes  we were able to find the gene name on BiomaRt
head(up_genes_names_Salmon[order(up_genes_names_Salmon$padj),],30)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["external_gene_name"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"445.57892","2":"1.087028","3":"0.2162713","4":"5.026222","5":"5.002359e-07","6":"0.0008326705","7":"VIP","_rn_":"ENSSSCG00000004078"},{"1":"4568.23194","2":"1.108817","3":"0.2295290","4":"4.830837","5":"1.359605e-06","6":"0.0015667876","7":"APOA4","_rn_":"ENSSSCG00000040689"},{"1":"52.92358","2":"1.545866","3":"0.3640045","4":"4.246831","5":"2.168153e-05","6":"0.0092803142","7":"","_rn_":"ENSSSCG00000015068"},{"1":"269.96680","2":"1.005522","3":"0.2452935","4":"4.099262","5":"4.144701e-05","6":"0.0129870151","7":"CNTN1","_rn_":"ENSSSCG00000000789"},{"1":"39.28067","2":"1.953554","3":"0.4925752","4":"3.966002","5":"7.308823e-05","6":"0.0188781867","7":"","_rn_":"ENSSSCG00000035712"},{"1":"33.30967","2":"1.498743","3":"0.3838922","4":"3.904074","5":"9.458674e-05","6":"0.0226035084","7":"","_rn_":"ENSSSCG00000038602"},{"1":"77.11636","2":"1.611269","3":"0.4285023","4":"3.760235","5":"1.697537e-04","6":"0.0313960432","7":"EDA","_rn_":"ENSSSCG00000021647"},{"1":"446.31758","2":"1.074065","3":"0.2966684","4":"3.620422","5":"2.941229e-04","6":"0.0427316991","7":"GALC","_rn_":"ENSSSCG00000027865"},{"1":"97.06451","2":"1.110386","3":"0.3212803","4":"3.456128","5":"5.479958e-04","6":"0.0652922265","7":"CTBS","_rn_":"ENSSSCG00000003758"},{"1":"345.24504","2":"1.028259","3":"0.3014052","4":"3.411552","5":"6.459416e-04","6":"0.0691203691","7":"P3H2","_rn_":"ENSSSCG00000011813"},{"1":"100.11980","2":"1.236174","3":"0.3648922","4":"3.387777","5":"7.046149e-04","6":"0.0725973357","7":"CBLN2","_rn_":"ENSSSCG00000020859"},{"1":"113.81864","2":"1.071681","3":"0.3207259","4":"3.341423","5":"8.335007e-04","6":"0.0816122502","7":"NSG2","_rn_":"ENSSSCG00000016979"},{"1":"112.86255","2":"1.399114","3":"0.4237886","4":"3.301443","5":"9.618872e-04","6":"0.0884051025","7":"FABP4","_rn_":"ENSSSCG00000040681"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>I will use the list to annotate the total DE genes using the Biomart in Ensembl.And get the top 6 with lowest padjusted.</p>
<pre class="r"><code>#I will get the IDS and will use the following code
gene_names&lt;- getBM(attributes = c(&quot;ensembl_gene_id&quot;,&quot;external_gene_name&quot;), filters= &quot;ensembl_gene_id&quot;, values = rownames(resSig_Salmon), mart = Pig_ensembl)
gene_names&lt;-transform(merge(as.data.frame(resSig_Salmon),gene_names,by.x=0, by.y =&quot;ensembl_gene_id&quot;,all=TRUE), row.names=Row.names, Row.names=NULL)
gene_names&lt;-as.data.frame(gene_names[order(gene_names$padj),])
head(gene_names)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["baseMean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["log2FoldChange"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lfcSE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["stat"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pvalue"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["padj"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["external_gene_name"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"445.57892","2":"1.087028","3":"0.2162713","4":"5.026222","5":"5.002359e-07","6":"0.0008326705","7":"VIP","_rn_":"ENSSSCG00000004078"},{"1":"1344.22176","2":"-2.162978","3":"0.4414607","4":"-4.899593","5":"9.603516e-07","6":"0.0011989189","7":"","_rn_":"ENSSSCG00000036127"},{"1":"4568.23194","2":"1.108817","3":"0.2295290","4":"4.830837","5":"1.359605e-06","6":"0.0015667876","7":"APOA4","_rn_":"ENSSSCG00000040689"},{"1":"98.56452","2":"-1.813641","3":"0.3880024","4":"-4.674305","5":"2.949504e-06","6":"0.0024548069","7":"","_rn_":"ENSSSCG00000031595"},{"1":"77.70074","2":"-1.988181","3":"0.4326390","4":"-4.595474","5":"4.317676e-06","6":"0.0028123089","7":"CD1E","_rn_":"ENSSSCG00000006450"},{"1":"2891.41558","2":"-1.018606","3":"0.2197978","4":"-4.634286","5":"3.581708e-06","6":"0.0028123089","7":"C1QB","_rn_":"ENSSSCG00000033512"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="diagnostic-plots" class="section level2">
<h2><span class="header-section-number">2.7</span> Diagnostic plots</h2>
<p>To plot the counts of specific genes we can use the name of the gene or a a specific value related to it.</p>
<div id="volcano-plot" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Volcano plot</h3>
<pre class="r"><code># volcano plot 
plot(res$log2FoldChange, -log(res$pvalue),main =&quot;Volcano plot Salmon data from DESeq2&quot;, xlab= &quot;Log2FoldChange&quot;, ylab = &quot;-log(Pvalue)&quot;, pch = 21, col=ifelse(res$pvalue &lt;0.001,&quot;red&quot;,&quot;black&quot;), xlim= c(-5,5), ylim =c(0,25), abline(v=c(-2,2)))</code></pre>
<p><img src="FiguresVolcano_plot-1.png" /><!-- --></p>
</div>
<div id="plotting-the-gene-with-lowest-p.adjusted" class="section level3">
<h3><span class="header-section-number">2.7.2</span> Plotting the gene with lowest p. adjusted</h3>
<pre class="r"><code># using the lower padj
topGene&lt;- row.names(resSig_Salmon[which.min(resSig_Salmon$padj),])
plotCounts(dds,gene= topGene,main = gene_names$external_gene_name[1], intgroup=&quot;Group&quot;)</code></pre>
<p><img src="Figureslowest_padj-1.png" /><!-- --></p>
</div>
<div id="to-do-the-ma-plot" class="section level3">
<h3><span class="header-section-number">2.7.3</span> to do the MA plot:</h3>
<pre class="r"><code>plotMA(res, ylim=c(-20,20))</code></pre>
<p><img src="FiguresMA_plot-1.png" /><!-- --></p>
</div>
<div id="to-plot-dispersion.within-group-variability-of-each-gene" class="section level3">
<h3><span class="header-section-number">2.7.4</span> To plot dispersion.(within group variability of each gene )</h3>
<pre class="r"><code>plotDispEsts(dds)</code></pre>
<p><img src="Figuresdispersion_plot-1.png" /><!-- --></p>
</div>
<div id="histogram-of-pvalues" class="section level3">
<h3><span class="header-section-number">2.7.5</span> histogram of pvalues</h3>
<pre class="r"><code>hist(res$pvalue[res$baseMean&gt;1], breaks=20, col=&quot;grey50&quot;, border=&quot;white&quot;)</code></pre>
<p><img src="Figurespvalues_histogram-1.png" /><!-- --></p>
</div>
<div id="clustering" class="section level3">
<h3><span class="header-section-number">2.7.6</span> Clustering</h3>
<p>Clustering the rlog counts of the 50 more variable DE genes</p>
<pre class="r"><code>library(genefilter)
#most hihgly variable genes
topVarGenes&lt;- head(order(-rowVars(assay(rlogdds))),50)
colors&lt;- colorRampPalette(rev(brewer.pal(9,&quot;PuOr&quot;)))(255)
sidecols&lt;- c(&quot;grey&quot;, &quot;dodgerblue&quot;)[rlogdds$Group]
mat&lt;- assay(rlogdds)[topVarGenes,]
mat&lt;- mat - rowMeans(mat)
colnames(mat)&lt;- paste0(rlogdds$Group)
heatmap.2(mat,Colv=F, trace=&quot;none&quot;, col=colors, ColSideColors=sidecols, labRow=F, mar=c(10,2),scale=&quot;row&quot;)</code></pre>
<pre><code>## Warning in heatmap.2(mat, Colv = F, trace = &quot;none&quot;, col = colors,
## ColSideColors = sidecols, : Discrepancy: Colv is FALSE, while dendrogram is
## `both&#39;. Omitting column dendogram.</code></pre>
<p><img src="FiguresClustering_rlog-1.png" /><!-- --></p>
</div>
<div id="doing-the-clustering-with-normalized-counts-instead-of-rlog-counts" class="section level3">
<h3><span class="header-section-number">2.7.7</span> Doing the clustering with normalized counts instead of rlog Counts</h3>
<p>TPM of the 150 more variable DE genes(if DE genes &lt; 150, all genes)</p>
<pre class="r"><code># Prepare for the heatmap

# Get some nicer colours
mypalette &lt;- brewer.pal(11,&quot;RdYlBu&quot;)

morecols &lt;- colorRampPalette(mypalette)

# Load library for heatmap
heatmap.2(highly_variable_norm_counts, col=rev(morecols(50)), trace=&quot;none&quot;,
              main=&quot;Most variable genes across samples&quot;, scale=&quot;row&quot;,
              labCol = labels)</code></pre>
<p><img src="Figurestpm_clustering-1.png" /><!-- --></p>
<pre class="r"><code>#To save the gene lists in both the cluster( 100 more variable genes in the resSig_Salmon2 table) and in the resSig_Salmon2 so I can used the transcripts to annotation and the other downstream application like panther or DAVID.</code></pre>
<p>Cluster with all the DE genes using TPM</p>
<pre class="r"><code>DE_counts&lt;- tpmDE
heatmap.2(DE_counts, col=rev(morecols(50)), trace=&quot;none&quot;,
              main=&quot;Most variable genes across samples&quot;, scale=&quot;row&quot;,
              labCol = labels)</code></pre>
<p><img src="Figurescluster_tpmde_all1-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="pathway-analysis-using-david-and-reactome" class="section level1">
<h1><span class="header-section-number">3</span> Pathway analysis using DAVID and Reactome</h1>
<p>I will use the lists to do the Pathway analysis with ReactomePA and DAVIDWebService</p>
<p>Fist, geting the GO terms for the DEgenes (padj,0.1, L2FC 1)- this will show only in R. And for that I will connect to DAVID.</p>
<p>To see the percentage of the genes that were identified by the DAVID</p>
<pre class="r"><code>DAVID_results_DESeq$inDavid</code></pre>
<p>[1] 0.4864865</p>
<p>And then you can create the results charts from DAVID and filter it by biological process:</p>
<pre class="r"><code>DAVID_results_chart&lt;- getFunctionalAnnotationChart(david)
#If I want to create a file with the chart information I would use the following code:
#DAVID_results_chart&lt;-DAVIDFunctionalAnnotationChartFile(DAVID_results_chart)
DAVID_results_chart_DESeq_BP&lt;-DAVID_results_chart[DAVID_results_chart$Category == &quot;GOTERM_BP_DIRECT&quot; &amp; DAVID_results_chart$PValue &lt; 0.05,]</code></pre>
<p>Plot of the top pathways and the evidence found in the list of DE genes.</p>
<pre class="r"><code>if(dim(DAVID_results_chart_DESeq_BP)[1]&gt;0){
plot2D(DAVIDFunctionalAnnotationChart(DAVID_results_chart_DESeq_BP[1:5,]),
       color=c(&quot;FALSE&quot;=&quot;black&quot;, &quot;TRUE&quot;=&quot;green&quot;))
# We can see the top 5 GO pathways for biological process, and note how the evidence is true in our data for each of the genes in the pathway( if it is present on our sample or not)
#We can also use the chart to do a godag plot
} else {
  print(&quot;No significant term found&quot;)
}</code></pre>
<p><img src="Figuresplot2D_BP-1.png" /><!-- --></p>
<pre class="r"><code>DAVIDGODag_DESeq&lt;-DAVIDGODag(DAVIDFunctionalAnnotationChart(DAVID_results_chart_DESeq_BP), type =&quot;BP&quot;,pvalueCutoff=.001)
#I can isolate the significant ones by doing a dataframe but the resulting plot is the same 
#sig_DAVID_RES_CHART&lt;- DAVID_results_chart_BP[DAVID_results_chart_BP$PValue &lt;0.001,]
#sig_DAVID_RES_GODAG&lt;- DAVIDGODag(DAVIDFunctionalAnnotationChart(sig_DAVID_RES_CHART), type =&quot;BP&quot;,pvalueCutoff=.001)
#we used a cutoff of 0.001 f or the pvalue. And now we can inspect the Dag object</code></pre>
<p>The Pathways with pvalue lower than 0.0001 and table containing the pathways and pvalues.</p>
<pre class="r"><code>sigCategories(DAVIDGODag_DESeq, p=0.0001)</code></pre>
<p>NULL</p>
<pre class="r"><code>summary(DAVIDGODag_DESeq)</code></pre>
<pre><code>## Warning: No results met the specified criteria. Returning 0-row data.frame</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["GOBPID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Pvalue"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Count"],"name":[3],"type":["int"],"align":["right"]},{"label":["Size"],"name":[4],"type":["int"],"align":["right"]},{"label":["Term"],"name":[5],"type":["chr"],"align":["left"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>show(DAVIDGODag_DESeq)</code></pre>
<p>Gene to GO BP test for over-representation 0 GO BP ids tested (0 have p &lt; 0.001) Selected gene set size: 0</p>
<pre><code>## Warning in max(popTotals(r)): no non-missing arguments to max; returning -
## Inf</code></pre>
<pre><code>Gene universe size: -Inf 
Annotation package: DAVID.website </code></pre>
<pre class="r"><code># we can see by the FDR column that only the first 3 pathway are significant</code></pre>
<p>GoDag term graph</p>
<div id="using-goplot-to-visualize-the-goterm-from-david" class="section level2">
<h2><span class="header-section-number">3.1</span> Using GOplot to visualize the GOterm from DAVID</h2>
<p>First, we have to put the data in the format required by the package.</p>
<p>Now, that we have the data let’s try to plot it using GOplot.</p>
<div id="plot-the-pathway-colered-by-z-score-significance" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Plot the pathway colered by z-score significance</h3>
<pre class="r"><code>if(dim(david_fun)[1]&gt;0){
print(GOBar(circ, order.by.zscore = T ))}else {
  print(&quot;No significant terms&quot;)
}</code></pre>
<p><img src="FiguresGoBar-1.png" /><!-- --></p>
</div>
<div id="bubble-plot-of-pathways" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Bubble plot of pathways</h3>
<pre class="r"><code>if(min(circ$adj_pval)&lt;0.05){
print(GOBubble(circ, labels = 1))} else {
  print(&quot;No significant terms&quot;)
}</code></pre>
<p>[1] “No significant terms”</p>
</div>
<div id="plot-significant-enriched-pathways-and-de-genes" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Plot significant enriched pathways and DE Genes</h3>
<p>This plot is interesting because it shows which genes are up and down on the pathway</p>
<pre class="r"><code>if(dim(david_fun)[1]&gt;0){
nsub&lt;- ifelse(dim(circ[!duplicated(circ$term), ])[1] &gt; 10, 10, dim(circ[!duplicated(circ$term), ])[1]); 
print(GOCircle(circ,nsub = nsub))} else {
  print(&quot;No significant terms&quot;)
}</code></pre>
<p><img src="FiguresGOCircle-1.png" /><!-- -->TableGrob (1 x 2) “arrange”: 2 grobs z cells name grob 1 1 (1-1,1-1) arrange gtable[layout] 2 2 (1-1,2-2) arrange gtable[colhead-fg]</p>
<p>I can also plot the relationship between the DE genes and the most enriched pathways</p>
<pre class="r"><code>if(dim(david_fun)[1]&gt;0){
subData &lt;- subset(circ, term %in% process);
genes&lt;-subset(genelist, ID %in% subData$genes);
All_genes&lt;- getBM(attributes = c(&quot;ensembl_gene_id&quot;,&quot;external_gene_name&quot;), filters= &quot;ensembl_gene_id&quot;, values = row.names(res), mart = Pig_ensembl);
All_genes$external_gene_name&lt;-ifelse(All_genes$external_gene_name==&quot;&quot;, All_genes$ensembl_gene_id, All_genes$external_gene_name)
names_subData&lt;- subset(All_genes, ensembl_gene_id %in% subData$genes);
names_subData$external_gene_name&lt;- ifelse(names_subData$external_gene_name == &quot;&quot;, names_subData$ensembl_gene_id, names_subData$external_gene_name);
chord &lt;- chord_dat(circ, genes = genes, process = dataGOplot$process);
chord_names&lt;-as.data.frame(cbind(chord, names_subData[,&quot;external_gene_name&quot;][match(rownames(chord), names_subData$ensembl_gene_id)]));
row.names(chord)&lt;-chord_names$V7;
chord&lt;-chord[,colSums(chord != 0) &gt; 0];
print(GOChord(chord));
terms&lt;-dataGOplot$process[!is.na(dataGOplot$process)]
if(length(terms)&gt;2){
print(GOCluster(circ, terms, clust.by = &quot;term&quot;, lfc.col = c(&#39;darkgoldenrod1&#39;,&#39;black&#39;,&#39;cyan1&#39;)))}} else {
  print(&quot;No significant term found!&quot;)
}</code></pre>
<pre><code>## Batch submitting query [=&gt;------------------------] 6% eta: 20s
## Batch submitting query [=&gt;------------------------] 9% eta: 16s
## Batch submitting query [==&gt;-----------------------] 12% eta: 17s
## Batch submitting query [===&gt;----------------------] 15% eta: 24s
## Batch submitting query [====&gt;---------------------] 18% eta: 24s
## Batch submitting query [=====&gt;--------------------] 21% eta: 27s
## Batch submitting query [=====&gt;--------------------] 24% eta: 26s
## Batch submitting query [======&gt;-------------------] 27% eta: 30s
## Batch submitting query [=======&gt;------------------] 30% eta: 31s
## Batch submitting query [========&gt;-----------------] 33% eta: 29s
## Batch submitting query [========&gt;-----------------] 36% eta: 29s
## Batch submitting query [=========&gt;----------------] 39% eta: 26s
## Batch submitting query [==========&gt;---------------] 42% eta: 23s
## Batch submitting query [===========&gt;--------------] 45% eta: 23s
## Batch submitting query [============&gt;-------------] 48% eta: 21s
## Batch submitting query [============&gt;-------------] 52% eta: 22s
## Batch submitting query [=============&gt;------------] 55% eta: 22s
## Batch submitting query [==============&gt;-----------] 58% eta: 20s
## Batch submitting query [===============&gt;----------] 61% eta: 17s
## Batch submitting query [================&gt;---------] 64% eta: 16s
## Batch submitting query [================&gt;---------] 67% eta: 15s
## Batch submitting query [=================&gt;--------] 70% eta: 14s
## Batch submitting query [==================&gt;-------] 73% eta: 14s
## Batch submitting query [===================&gt;------] 76% eta: 12s
## Batch submitting query [===================&gt;------] 79% eta: 11s
## Batch submitting query [====================&gt;-----] 82% eta: 10s
## Batch submitting query [=====================&gt;----] 85% eta: 8s
## Batch submitting query [======================&gt;---] 88% eta: 7s
## Batch submitting query [=======================&gt;--] 91% eta: 5s Batch
## submitting query [=======================&gt;--] 94% eta: 3s Batch submitting
## query [========================&gt;-] 97% eta: 2s Batch submitting query
## [==========================] 100% eta: 0s</code></pre>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="FiguresGOplot_terms_and_genes-1.png" /><!-- --></p>
<pre class="r"><code>#the GOCluster indicated in the outer ring the pathway that the gene is associated to, the inner ring shows the log2fc of the gene and the clustering the gene by category, euclidean average </code></pre>
</div>
</div>
<div id="using-biomart-to-convert-the-genes-names-into-entrez-id-human-so-i-can-use-reactomepa-to-do-the-pathway-analysis" class="section level2">
<h2><span class="header-section-number">3.2</span> Using Biomart to convert the genes names into entrez ID (human) so I can use ReactomePA to do the pathway analysis</h2>
<p>First table converting all the genes to entrex id and then filtering by padj &lt; 0.1</p>
</div>
<div id="using-reactome-to-analize-subsetted-from-all-genes" class="section level2">
<h2><span class="header-section-number">3.3</span> Using reactome to analize subsetted from all genes</h2>
<pre class="r"><code>if(!is.null(x)){
if(min(x@result$p.adjust)&lt;0.05){
sprintf(&quot;Barplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s&quot;, groups[1],groups[2]);
print(barplot(x, showCategory = 30));
sprintf(&quot;Dotplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s&quot;, groups[1],groups[2]);
print(dotplot(x, showCategory=15));
sprintf(&quot;Enrichment map plot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s&quot;, groups[1],groups[2]);
print(emapplot(x, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;,colorEdge = TRUE)); 
print(cnetplot(x,showCategory = 5, categorySize = &quot;pvalue&quot;, foldChange = DE_genes_entrez_rank$log2FoldChange, node_label= F, colorEdge = T))}} else {
  print(&quot;no enriched term found&quot;)
}</code></pre>
<pre><code>## wrong orderBy parameter; set to default `orderBy = &quot;x&quot;`</code></pre>
<p><img src="FiguresReactome_plots-1.png" /><img src="FiguresReactome_plots-2.png" /><img src="FiguresReactome_plots-3.png" /><img src="FiguresReactome_plots-4.png" /></p>
<pre class="r"><code>y&lt;- gsePathway(DE_genes_list, nPerm = 1000,minGSSize = 10, pvalueCutoff = 0.05, pAdjustMethod = &quot;BH&quot;)</code></pre>
<pre><code>## preparing geneSet collections...</code></pre>
<pre><code>## GSEA analysis...</code></pre>
<pre><code>## leading edge analysis...</code></pre>
<pre><code>## done...</code></pre>
<pre class="r"><code>if(nrow(y) &gt; 0){
print(gseaplot(y, geneSetID =(as.data.frame(y))[1,1],title = as.character((as.data.frame(y))[1,2])));
print(cnetplot(y, categorySize = &quot;pvalue&quot;, foldChange = DE_genes_entrez_rank$log2FoldChange,colorEdge = T));
print(emapplot(y, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;));
}</code></pre>
<p><img src="FiguresReactome_plots-5.png" /><img src="FiguresReactome_plots-6.png" /><img src="FiguresReactome_plots-7.png" /></p>
<pre class="r"><code>#DEunique&lt;- DE_genes_list[!duplicated(names(DE_genes_list))]</code></pre>
</div>
<div id="reactome-of-the-upregulated-genes" class="section level2">
<h2><span class="header-section-number">3.4</span> Reactome of the upregulated genes</h2>
<pre class="r"><code>if(!is.null(x)){
if(min(x@result$p.adjust)&lt;0.05){
sprintf(&quot;Barplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s up regulated genes&quot;, groups[1],groups[2]);
print(barplot(x, showCategory = 30));
sprintf(&quot;Dotplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s up regulated genes&quot;, groups[1],groups[2]);
print(dotplot(x, showCategory=15));
sprintf(&quot;Enrichment map plot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s upregulated genes&quot;, groups[1],groups[2]);
print(emapplot(x, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;,colorEdge = TRUE));
print(cnetplot(x,showCategory = 5, categorySize = &quot;pvalue&quot;, foldChange = up_genes_list, node_label= F, colorEdge = T));
}}
y&lt;- gsePathway(up_genes_list, nPerm = 1000,minGSSize = 10, pvalueCutoff = 0.05, pAdjustMethod = &quot;BH&quot;)</code></pre>
<pre><code>## preparing geneSet collections...</code></pre>
<pre><code>## GSEA analysis...</code></pre>
<pre><code>## no term enriched under specific pvalueCutoff...</code></pre>
<pre class="r"><code>if(nrow(y) &gt; 0){
print(gseaplot(y, geneSetID =(as.data.frame(y))[1,1],title = as.character((as.data.frame(y))[1,2])));
print(cnetplot(y, categorySize = &quot;pvalue&quot;, foldChange = upentrez$log2FoldChange,colorEdge = T));
print(emapplot(y, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;));
}</code></pre>
</div>
<div id="reactome-of-downregulated-genes" class="section level2">
<h2><span class="header-section-number">3.5</span> Reactome of downregulated genes</h2>
<pre class="r"><code>if(!is.null(x)){
if(min(x@result$p.adjust)&lt;0.05){
sprintf(&quot;Barplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s downregulated genes&quot;, groups[1],groups[2]);
print(barplot(x, showCategory = 30));
sprintf(&quot;Dotplot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s downregulated genes&quot;, groups[1],groups[2]);
print(dotplot(x, showCategory = 15));
sprintf(&quot;Enrichment map plot for the most enriched reactome pathway for Salmon/DESeq analysis for comparison %s vc %s downregulated genes&quot;, groups[1],groups[2])
print(emapplot(x, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;)); 
print(cnetplot(x,showCategory = 5, categorySize = &quot;pvalue&quot;, foldChange = down_genes_list, node_label= FALSE, colorEdge = TRUE));
}}</code></pre>
<pre><code>## wrong orderBy parameter; set to default `orderBy = &quot;x&quot;`</code></pre>
<p><img src="Figuresreactomrdown_plots-1.png" /><img src="Figuresreactomrdown_plots-2.png" /><img src="Figuresreactomrdown_plots-3.png" /><img src="Figuresreactomrdown_plots-4.png" /></p>
<pre class="r"><code>y&lt;- gsePathway(down_genes_list, nPerm = 1000,minGSSize = 10, pvalueCutoff = 0.05, pAdjustMethod = &quot;BH&quot;)</code></pre>
<pre><code>## preparing geneSet collections...</code></pre>
<pre><code>## GSEA analysis...</code></pre>
<pre><code>## no term enriched under specific pvalueCutoff...</code></pre>
<pre class="r"><code>if(nrow(y) &gt; 0){
print(gseaplot(y, geneSetID =(as.data.frame(y))[1,1],title = as.character((as.data.frame(y))[1,2])));
print(cnetplot(y, categorySize = &quot;pvalue&quot;, foldChange = downentrez$log2FoldChange,colorEdge = T));
print(emapplot(y, showCategory = 15, color = &quot;p.adjust&quot;,layout = &quot;kk&quot;))
}
#downunique&lt;- down_genes_list[!duplicated(names(down_genes_list))]
#viewPathway(as.character((as.data.frame(y))[1,2]), readable = T, foldChange = downunique )</code></pre>
</div>
</div>
<div id="edger-analysis" class="section level1">
<h1><span class="header-section-number">4</span> EdgeR analysis</h1>
<p>We can repeat the same analysis using edgeR as the inference engine (Robinson, McCarthy, and Smyth 2009). The following code incorporates the average transcript length matrix as an offset for an edgeR analysis.</p>
<p>But I will use the tximport object to get the data to EdgeR, and normalize the data by the length of the transcript.</p>
<div id="the-results-from-the-edger" class="section level2">
<h2><span class="header-section-number">4.1</span> The results from the EdgeR</h2>
<div id="counts-of-the-edgerdataset" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Counts of the EdgeRdataset</h3>
<pre class="r"><code>head(as.data.frame(EdgeR_s$counts))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Goat_milk1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Goat_milk2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Goat_milk3"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Goat_milk4"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["hLZ_milk1"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hLZ_milk2"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["hLZ_milk3"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["hLZ_milk4"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"2241.0622","2":"2413.056","3":"2411.071","4":"1705.017","5":"1740.0039","6":"2006.0039","7":"2425.9998","8":"2709.1193","_rn_":"ENSSSCG00000000002"},{"1":"2064.3780","2":"2533.195","3":"1848.915","4":"3698.583","5":"3288.5607","6":"1899.2535","7":"2696.6298","8":"2007.5948","_rn_":"ENSSSCG00000000003"},{"1":"225.0000","2":"329.000","3":"319.000","4":"271.000","5":"238.0000","6":"183.0000","7":"260.0000","8":"268.0000","_rn_":"ENSSSCG00000000005"},{"1":"535.0000","2":"345.000","3":"171.000","4":"537.000","5":"594.0000","6":"183.0000","7":"345.0000","8":"276.0000","_rn_":"ENSSSCG00000000006"},{"1":"534.9999","2":"583.000","3":"632.000","4":"346.000","5":"531.0004","6":"438.9999","7":"656.0004","8":"644.0004","_rn_":"ENSSSCG00000000007"},{"1":"922.9770","2":"2105.593","3":"1070.942","4":"2525.892","5":"1435.7780","6":"986.3270","7":"1334.7790","8":"1090.3180","_rn_":"ENSSSCG00000000010"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="mds-plot" class="section level3">
<h3><span class="header-section-number">4.1.2</span> MDS plot</h3>
<pre class="r"><code>plotMDS(EdgeR_s)</code></pre>
<p><img src="FiguresMDS_plot_EdgeR-1.png" /><!-- --></p>
</div>
<div id="de-analysis-using-exact-test" class="section level3">
<h3><span class="header-section-number">4.1.3</span> DE analysis using exact test</h3>
<p>I will use the exact test to do the pairwise comparison without any batch effect.</p>
<p>And the number of genes with pvalue &lt; 0.1</p>
<pre class="r"><code>EdgeR_s$samples$W1&lt;-set_n$W_1
design&lt;-model.matrix(as.formula(~ W1+ group),data =EdgeR_s$samples)
DE_fit&lt;-glmQLFit(EdgeR_s,design=design)
DE_single_factor_edgeR&lt;- glmQLFTest(DE_fit)
sig_DE_EdgeR&lt;-DE_single_factor_edgeR$table[DE_single_factor_edgeR$table$PValue &lt; 0.1,]
dim(sig_DE_EdgeR)</code></pre>
<p>[1] 2323 4</p>
<pre class="r"><code>#FDR_edgeR&lt;-p.adjust(DE_single_factor_edgeR$table$PValue, method = &quot;fdr&quot;)
#DE_Table&lt;-cbind(DE_single_factor_edgeR$table,FDR_edgeR)
#sig_Table&lt;- DE_Table[DE_Table$FDR_edgeR&lt; 0.1 &amp; DE_Table$logFC &gt; 1 | DE_Table$logFC &lt; -1,]</code></pre>
</div>
<div id="the-toptags-table-for-the-sig.-de-genes" class="section level3">
<h3><span class="header-section-number">4.1.4</span> The toptags table for the sig. DE genes</h3>
<p>Number of Genes with log2FoldChange &lt; -1 or &gt; 1, and p.adjusted &lt; 0.1 and the table with the values.</p>
<pre class="r"><code>Topgenes_sfactor_edgeR&lt;-topTags(DE_single_factor_edgeR, n = nrow(sig_DE_EdgeR))
dim(Topgenes_sfactor_edgeR)</code></pre>
<p>[1] 2323 5</p>
<pre class="r"><code>#The FDR is adj. Pvalue  
Topgenes_sfactor_edgeR_0.1_1&lt;- 
Topgenes_sfactor_edgeR[Topgenes_sfactor_edgeR$table$FDR &lt; 0.1   &amp; Topgenes_sfactor_edgeR$table$logFC &lt; -1 | Topgenes_sfactor_edgeR$table$logFC &gt; 1,]
dim(Topgenes_sfactor_edgeR_0.1_1)</code></pre>
<p>[1] 23 5</p>
<pre class="r"><code>head(Topgenes_sfactor_edgeR_0.1_1$table)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["logFC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["logCPM"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["PValue"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["FDR"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.481857","2":"-0.2566712","3":"31.26701","4":"0.0003340193","5":"0.4047817","_rn_":"ENSSSCG00000038602"},{"1":"1.072615","2":"3.4480369","3":"26.36936","4":"0.0006092382","5":"0.4047817","_rn_":"ENSSSCG00000004078"},{"1":"1.523760","2":"0.4126745","3":"25.44213","4":"0.0006892844","5":"0.4047817","_rn_":"ENSSSCG00000015068"},{"1":"1.092766","2":"6.7501197","3":"20.99767","4":"0.0013126381","5":"0.4214813","_rn_":"ENSSSCG00000040689"},{"1":"1.591629","2":"0.9117237","3":"14.03504","4":"0.0045549574","5":"0.4385360","_rn_":"ENSSSCG00000021647"},{"1":"1.096009","2":"1.2508206","3":"13.18713","4":"0.0054449628","5":"0.4385360","_rn_":"ENSSSCG00000003758"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>Top_Genes_Table&lt;-Topgenes_sfactor_edgeR_0.1_1$table[order(Topgenes_sfactor_edgeR_0.1_1$table$FDR),]
saveRDS(Top_Genes_Table, file = file.path(output_dir,sprintf(&quot;%s_vs_%s_EdgeR_sig_Sal_w_outliers.RDS&quot;,groups[1], groups[2])))</code></pre>
</div>
</div>
<div id="get-the-down-regulated-genes" class="section level2">
<h2><span class="header-section-number">4.2</span> Get the down regulated genes</h2>
<pre class="r"><code>Topgenes_sfactor_edgeR_0.1_1_down&lt;- Topgenes_sfactor_edgeR_0.1_1[Topgenes_sfactor_edgeR_0.1_1$table$logFC &lt; 0, ]
Topgenes_sfactor_edgeR_0.1_1_down&lt;- Topgenes_sfactor_edgeR_0.1_1_down[order(Topgenes_sfactor_edgeR_0.1_1_down$table$logFC), ]
head(Topgenes_sfactor_edgeR_0.1_1_down$table)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["logFC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["logCPM"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["PValue"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["FDR"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>dim(Topgenes_sfactor_edgeR_0.1_1_down$table)</code></pre>
<p>[1] 0 5</p>
</div>
<div id="getting-the-upregulated-genes" class="section level2">
<h2><span class="header-section-number">4.3</span> Getting the upregulated genes</h2>
<pre class="r"><code>Topgenes_sfactor_edgeR_0.1_1_up&lt;- Topgenes_sfactor_edgeR_0.1_1[Topgenes_sfactor_edgeR_0.1_1$table$logFC &gt; 0, ]
Topgenes_sfactor_edgeR_0.1_1_up&lt;-Topgenes_sfactor_edgeR_0.1_1_up[order(-Topgenes_sfactor_edgeR_0.1_1_up$table$logFC), ]
head(Topgenes_sfactor_edgeR_0.1_1_up$table)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["logFC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["logCPM"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["PValue"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["FDR"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2.295578","2":"0.6440826","3":"7.964703","4":"0.0199154691","5":"0.5169854","_rn_":"ENSSSCG00000006141"},{"1":"2.187213","2":"2.3865516","3":"7.365532","4":"0.0237770390","5":"0.5237465","_rn_":"ENSSSCG00000039103"},{"1":"1.591629","2":"0.9117237","3":"14.035038","4":"0.0045549574","5":"0.4385360","_rn_":"ENSSSCG00000021647"},{"1":"1.523760","2":"0.4126745","3":"25.442129","4":"0.0006892844","5":"0.4047817","_rn_":"ENSSSCG00000015068"},{"1":"1.481857","2":"-0.2566712","3":"31.267010","4":"0.0003340193","5":"0.4047817","_rn_":"ENSSSCG00000038602"},{"1":"1.395741","2":"1.4626411","3":"10.329709","4":"0.0105481896","5":"0.4433050","_rn_":"ENSSSCG00000040681"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>dim(Topgenes_sfactor_edgeR_0.1_1_up$table)</code></pre>
<p>[1] 23 5</p>
</div>
<div id="creating-a-volcano-plot-and-a-heatmap" class="section level2">
<h2><span class="header-section-number">4.4</span> Creating a volcano plot and a heatmap</h2>
<pre class="r"><code>plot(DE_single_factor_edgeR$table$logFC,-log(DE_single_factor_edgeR$table$PValue),main =&quot;Volcano plot&quot;, xlab= &quot;Log2FoldChange&quot;, ylab = &quot;-log(Pvalue)&quot;, pch = 21, col=ifelse(DE_single_factor_edgeR$table$PValue&lt;0.001,&quot;red&quot;,&quot;black&quot;), xlim= c(-5,5), ylim =c(0,25), abline(v=c(-2,2)))</code></pre>
<p><img src="Figuresvolcano_plot_DE_EdgeR_Salmon-1.png" /><!-- --></p>
<p>heatmap using the top50 variable DE genes (normalized by library size)</p>
<pre class="r"><code>#Using normalized counts
counts_salmon_n &lt;- cpm(EdgeR_s, normalized.lib.sizes = T)
Sig_counts&lt;-counts_salmon_n[row.names(counts_salmon_n) %in% row.names(Topgenes_sfactor_edgeR_0.1_1$table),]
var_genes &lt;- apply(Sig_counts, 1, var)
head(var_genes)</code></pre>
<p>ENSSSCG00000000415 ENSSSCG00000003146 ENSSSCG00000003758 0.6199836 5.9601479 0.9992267 ENSSSCG00000004078 ENSSSCG00000004159 ENSSSCG00000006141 32.6224277 0.1645026 1.7195472</p>
<pre class="r"><code>Sig_counts&lt;- cbind(Sig_counts, var_genes)
Sig_counts&lt;-Sig_counts[order(Sig_counts[,7],decreasing =T),]
len&lt;-ifelse(dim(Sig_counts)[1]&lt;50, dim(Sig_counts)[1],50)
heatmap.2(Sig_counts[1:len,1:(ncol(Sig_counts)-1)],  trace=&quot;none&quot;, 
              main=&quot;Most variable genes across samples&quot;, scale=&quot;row&quot;,col = rev(morecols(50)),
              labCol = labels )</code></pre>
<p><img src="Figuresnormalized_counts_heatmap_edger-1.png" /><!-- --></p>
</div>
<div id="functional-analysis-of-the-edger-results" class="section level2">
<h2><span class="header-section-number">4.5</span> Functional analysis of the EdgeR results</h2>
<p>Using the DAVIDWEBServices to analize the DE genes and doing the plot2D of terms and evidence:</p>
<pre class="r"><code>if(is.connected(david)== FALSE) {
  connect(david)
}
DAVID_results_EdgeR&lt;- addList(david, row.names(Topgenes_sfactor_edgeR_0.1_1$table), idType = &quot;ENSEMBL_GENE_ID&quot; , listName = sprintf(&quot;%s_v_%s_Sig_genes_EdgeR&quot;,groups[1],groups[2]) ,listType = &quot;Gene&quot; )
# to see the p% of genes that were recognize on DAVID database
DAVID_results_EdgeR$inDavid</code></pre>
<p>[1] 0.5652174</p>
<pre class="r"><code>DAVID_results_chart&lt;- getFunctionalAnnotationChart(david)
DAVID_results_chart_EdgeR_BP&lt;-DAVID_results_chart[DAVID_results_chart$Category == &quot;GOTERM_BP_DIRECT&quot; &amp; DAVID_results_chart$PValue &lt; 0.05,]
if(dim(DAVID_results_chart_EdgeR_BP)[1]&gt;0){
plot2D(DAVIDFunctionalAnnotationChart(DAVID_results_chart_EdgeR_BP[1:5,]),
       color=c(&quot;FALSE&quot;=&quot;black&quot;, &quot;TRUE&quot;=&quot;green&quot;))
}else{
  print(&quot;No significant term found&quot;)
}</code></pre>
<p>[1] “No significant term found”</p>
</div>
</div>
<div id="comparing-the-results-from-deseq-and-edger" class="section level1">
<h1><span class="header-section-number">5</span> Comparing the results from DESeq and EdgeR</h1>
<pre class="r"><code>if(dim(DAVID_results_chart_DESeq_BP)[1]&gt;0 &amp; dim(DAVID_results_chart_EdgeR_BP)[1]&gt;0){
sprintf(&quot;DESeq2_%s_%s&quot;, groups[1],groups[2])
head(DAVID_results_chart_DESeq_BP[order(DAVID_results_chart_DESeq_BP$PValue),],10)
sprintf(&quot;EdgeR_%s_%s&quot;, groups[1],groups[2])
head(DAVID_results_chart_EdgeR_BP[order(DAVID_results_chart_EdgeR_BP$PValue),],10)
}else{
  print(&quot;Either DESeq or EdgeR functional chart is empty.&quot;)
}</code></pre>
<p>[1] “Either DESeq or EdgeR functional chart is empty.”</p>
<pre class="r"><code># We can see the top 5 GO pathways for biological process, and note how the evidence is true in our data for each of the genes in the pathway( if it is present on our sample or not)
#We can also use the chart to do a godag plot</code></pre>
<div id="significant-terms" class="section level2">
<h2><span class="header-section-number">5.1</span> Significant terms</h2>
<pre class="r"><code>DAVIDGODag_EdgeR&lt;-DAVIDGODag(DAVIDFunctionalAnnotationChart(DAVID_results_chart_EdgeR_BP), type =&quot;BP&quot;,pvalueCutoff=.001)
#we used a cutoff of 0.001 f or the pvalue. And now we can inspect the Dag object
sigCategories(DAVIDGODag_EdgeR, p=0.0001)</code></pre>
<p>NULL</p>
<pre class="r"><code>summary(DAVIDGODag_EdgeR)</code></pre>
<pre><code>## Warning: No results met the specified criteria. Returning 0-row data.frame</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["GOBPID"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Pvalue"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Count"],"name":[3],"type":["int"],"align":["right"]},{"label":["Size"],"name":[4],"type":["int"],"align":["right"]},{"label":["Term"],"name":[5],"type":["chr"],"align":["left"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>show(DAVIDGODag_EdgeR)</code></pre>
<p>Gene to GO BP test for over-representation 0 GO BP ids tested (0 have p &lt; 0.001) Selected gene set size: 0</p>
<pre><code>## Warning in max(popTotals(r)): no non-missing arguments to max; returning -
## Inf</code></pre>
<pre><code>Gene universe size: -Inf 
Annotation package: DAVID.website </code></pre>
<pre class="r"><code># we can see by the FDR column that only the first 3 pathway are significant</code></pre>
</div>
<div id="the-graph-using-the-edger-data" class="section level2">
<h2><span class="header-section-number">5.2</span> The graph using the EdgeR data</h2>
<pre class="r"><code>library(Rgraphviz)
plotGOTermGraph(g=goDag(DAVIDGODag_EdgeR), r= DAVIDGODag_EdgeR, max.nchar= 20, node.shape=&quot;ellipse&quot;,node.colors=c(sig=&quot;red&quot;, not=&quot;white&quot;))</code></pre>
<pre><code>## Warning in .local(x, y, ...): graph has zero nodes; cannot layout</code></pre>
</div>
<div id="comparison-between-the-deseq2-and-edger-results" class="section level2">
<h2><span class="header-section-number">5.3</span> Comparison between the DESeq2 and EdgeR results</h2>
<p>Venndiagram of total genes:</p>
<pre class="r"><code>library(VennDiagram)
# Total DE genes 
I_total&lt;- intersect(rownames(resSig_Salmon), rownames(Topgenes_sfactor_edgeR_0.1_1$table))
length(I_total)</code></pre>
<p>[1] 11</p>
<pre class="r"><code>grid.newpage()
draw.pairwise.venn(nrow(resSig_Salmon), nrow(Topgenes_sfactor_edgeR_0.1_1$table), length(I_total), category = c(&quot;DESeq2&quot;, &quot;EdgeR&quot;), lty = rep(&quot;blank&quot;, 
    2), fill = c(&quot;light blue&quot;, &quot;pink&quot;), alpha = rep(0.5, 2), cat.pos = c(-15, 
    0), cat.dist = rep(0.025, 2), title= &quot;DE genes from DESeq and EdgeR&quot;)</code></pre>
<p><img src="Figuresintersect_DESeq_EdgeR-1.png" /><!-- -->(polygon[GRID.polygon.71088], polygon[GRID.polygon.71089], polygon[GRID.polygon.71090], polygon[GRID.polygon.71091], text[GRID.text.71092], text[GRID.text.71093], text[GRID.text.71094], text[GRID.text.71095], text[GRID.text.71096])</p>
<div id="comparison-between-the-downregulated-genes" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Comparison between the downregulated genes</h3>
<pre class="r"><code>I_down&lt;- intersect(rownames(downresSig_Salmon), rownames(Topgenes_sfactor_edgeR_0.1_1_down$table))
length(I_down)</code></pre>
<p>[1] 0</p>
<pre class="r"><code>grid.newpage()
draw.pairwise.venn(nrow(downresSig_Salmon), nrow(Topgenes_sfactor_edgeR_0.1_1_down$table), length(I_down), category = c(&quot;DESeq2&quot;, &quot;EdgeR&quot;), lty = rep(&quot;blank&quot;, 
    2), fill = c(&quot;light blue&quot;, &quot;pink&quot;), alpha = rep(0.5, 2), cat.pos = c(-15, 
    0), cat.dist = rep(0.025, 2), title= &quot;Down regulated genes according to DESeq and/or EdgeR&quot;)</code></pre>
<p><img src="Figuresdown_venndiagram-1.png" /><!-- -->(polygon[GRID.polygon.71097], polygon[GRID.polygon.71098], polygon[GRID.polygon.71099], polygon[GRID.polygon.71100], text[GRID.text.71101], text[GRID.text.71102], text[GRID.text.71103], text[GRID.text.71104])</p>
</div>
<div id="the-upregulated-genes" class="section level3">
<h3><span class="header-section-number">5.3.2</span> The upregulated genes</h3>
<pre class="r"><code>I_up&lt;- intersect(rownames(upresSig_Salmon), rownames(Topgenes_sfactor_edgeR_0.1_1_up$table))
length(I_up)</code></pre>
<p>[1] 11</p>
<pre class="r"><code>grid.newpage()
draw.pairwise.venn(nrow(upresSig_Salmon), nrow(Topgenes_sfactor_edgeR_0.1_1_up$table), length(I_up), category = c(&quot;DESeq2&quot;, &quot;EdgeR&quot;), lty = rep(&quot;blank&quot;, 
    2), fill = c(&quot;light blue&quot;, &quot;pink&quot;), alpha = rep(0.5, 2), cat.pos = c(-15, 
    0), cat.dist = rep(0.025, 2), title= &quot;up DE genes from DESeq and EdgeR&quot;)</code></pre>
<p><img src="Figuresvenn_up-1.png" /><!-- -->(polygon[GRID.polygon.71105], polygon[GRID.polygon.71106], polygon[GRID.polygon.71107], polygon[GRID.polygon.71108], text[GRID.text.71109], text[GRID.text.71110], text[GRID.text.71111], text[GRID.text.71112], text[GRID.text.71113])</p>
</div>
</div>
<div id="get-the-list-of-the-genes-that-are-in-both-deseq2-and-edger-de-genes." class="section level2">
<h2><span class="header-section-number">5.4</span> Get the list of the genes that are in both DESeq2 and edgeR DE genes.</h2>
<pre class="r"><code>head(I_total)</code></pre>
<p>[1] “ENSSSCG00000004078” “ENSSSCG00000040689” “ENSSSCG00000015068” [4] “ENSSSCG00000038602” “ENSSSCG00000021647” “ENSSSCG00000027865”</p>
<pre class="r"><code>Salmon_intersect&lt;-gene_names[rownames(gene_names) %in% I_total, ]
saveRDS(Salmon_intersect,file = file.path(output_dir,sprintf(&quot;%s_vs_%s_Salmon_intersect_w_outliers.RDS&quot;,groups[1], groups[2])))</code></pre>
<div id="session-info" class="section level6">
<h6><span class="header-section-number">5.4.0.0.0.1</span> Session info</h6>
<pre class="r"><code>sessionInfo()</code></pre>
<p>R version 3.6.0 (2019-04-26) Platform: i386-w64-mingw32/i386 (32-bit) Running under: Windows &gt;= 8 x64 (build 9200)</p>
<p>Matrix products: default</p>
<p>locale: [1] LC_COLLATE=English_United States.1252 [2] LC_CTYPE=English_United States.1252<br />
[3] LC_MONETARY=English_United States.1252 [4] LC_NUMERIC=C<br />
[5] LC_TIME=English_United States.1252</p>
<p>attached base packages: [1] grid stats4 parallel stats graphics grDevices utils<br />
[8] datasets methods base</p>
<p>other attached packages: [1] RDAVIDWebService_1.22.0 VennDiagram_1.6.20<br />
[3] futile.logger_1.4.3 org.Hs.eg.db_3.8.2<br />
[5] ReactomePA_1.28.0 GOplot_1.0.2<br />
[7] gridExtra_2.3 ggdendro_0.1-20<br />
[9] Rgraphviz_2.28.0 GO.db_3.8.2<br />
[11] genefilter_1.66.0 biomaRt_2.40.0<br />
[13] pheatmap_1.0.12 gplots_3.0.1.1<br />
[15] PoiClaClu_1.0.2.1 RUVSeq_1.18.0<br />
[17] edgeR_3.26.0 limma_3.40.0<br />
[19] RColorBrewer_1.1-2 EDASeq_2.18.0<br />
[21] ShortRead_1.42.0 GenomicAlignments_1.20.0<br />
[23] Rsamtools_2.0.0 Biostrings_2.52.0<br />
[25] XVector_0.24.0 DESeq2_1.24.0<br />
[27] SummarizedExperiment_1.14.0 DelayedArray_0.10.0<br />
[29] BiocParallel_1.17.18 matrixStats_0.54.0<br />
[31] GenomicRanges_1.36.0 GenomeInfoDb_1.20.0<br />
[33] tximport_1.12.0 knitr_1.22<br />
[35] ggplot2_3.1.1 GOstats_2.50.0<br />
[37] Category_2.50.0 Matrix_1.2-17<br />
[39] AnnotationDbi_1.46.0 IRanges_2.18.0<br />
[41] S4Vectors_0.22.0 Biobase_2.44.0<br />
[43] graph_1.62.0 BiocGenerics_0.30.0</p>
<p>loaded via a namespace (and not attached): [1] splines_3.6.0 ggplotify_0.0.3 urltools_1.7.3<br />
[4] bitops_1.0-6 tibble_2.1.1 R.oo_1.22.0<br />
[7] polyclip_1.10-0 triebeard_0.3.0 rpart_4.1-15<br />
[10] XML_3.98-1.19 MASS_7.3-51.4 lattice_0.20-38<br />
[13] magrittr_1.5 backports_1.1.4 rmarkdown_1.12<br />
[16] Hmisc_4.2-0 yaml_2.2.0 cowplot_0.9.4<br />
[19] DBI_1.0.0 zlibbioc_1.30.0 rvcheck_0.1.3<br />
[22] R.utils_2.8.0 purrr_0.3.2 RCurl_1.95-4.12<br />
[25] ggraph_1.0.2 nnet_7.3-12 rappdirs_0.3.1<br />
[28] tweenr_1.0.1 GenomeInfoDbData_1.2.1 enrichplot_1.4.0<br />
[31] ggrepel_0.8.0 AnnotationForge_1.26.0 gdata_2.18.0<br />
[34] acepack_1.4.1 reactome.db_1.68.0 annotate_1.62.0<br />
[37] xml2_1.2.0 ggforce_0.2.2 DOSE_3.10.0<br />
[40] tidyselect_0.2.5 farver_1.1.0 viridis_0.5.1<br />
[43] base64enc_0.1-3 DO.db_2.9 jsonlite_1.6<br />
[46] Formula_1.2-3 survival_2.44-1.1 ggridges_0.5.1<br />
[49] progress_1.2.0 tools_3.6.0 Rcpp_1.0.1<br />
[52] glue_1.3.1 xfun_0.6 qvalue_2.16.0<br />
[55] dplyr_0.8.0.1 withr_2.1.2 formatR_1.6<br />
[58] latticeExtra_0.6-28 digest_0.6.18 caTools_1.17.1.2<br />
[61] gridGraphics_0.4-0 R6_2.4.0 colorspace_1.4-1<br />
[64] gtools_3.8.1 RSQLite_2.1.1 R.methodsS3_1.7.1<br />
[67] UpSetR_1.3.3 data.table_1.12.2 rtracklayer_1.44.0<br />
[70] prettyunits_1.0.2 htmlwidgets_1.3 httr_1.4.0<br />
[73] graphite_1.30.0 pkgconfig_2.0.2 gtable_0.3.0<br />
[76] rJava_0.9-11 blob_1.1.1 hwriter_1.3.2<br />
[79] htmltools_0.3.6 fgsea_1.10.0 geneplotter_1.62.0<br />
[82] RBGL_1.60.0 GSEABase_1.46.0 scales_1.0.0<br />
[85] lambda.r_1.2.3 rstudioapi_0.10 reshape2_1.4.3<br />
[88] curl_3.3 checkmate_1.9.3 stringr_1.4.0<br />
[91] KernSmooth_2.23-15 foreign_0.8-71 pillar_1.3.1<br />
[94] cluster_2.0.9 xtable_1.8-4 htmlTable_1.13.1<br />
[97] evaluate_0.13 GenomicFeatures_1.36.0 readr_1.3.1<br />
[100] futile.options_1.0.1 compiler_3.6.0 locfit_1.5-9.1<br />
[103] crayon_1.3.4 rlang_0.3.4 labeling_0.3<br />
[106] aroma.light_3.14.0 plyr_1.8.4 stringi_1.4.3<br />
[109] viridisLite_0.3.0 assertthat_0.2.1 munsell_0.5.0<br />
[112] lazyeval_0.2.2 GOSemSim_2.10.0 europepmc_0.3<br />
[115] hms_0.4.2 bit64_0.9-7 highr_0.8<br />
[118] DESeq_1.36.0 igraph_1.2.4.1 memoise_1.1.0<br />
[121] fastmatch_1.1-0 bit_1.1-14</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
